<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Ù…ÙˆÙ„Ø¯ Ø§Ù„ØªØ±Ø§Ø®ÙŠØµ Ø§Ù„Ø´Ø§Ù…Ù„ | ERPX Admin</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.1.1/crypto-js.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700;900&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Cairo', sans-serif; background-color: #0f172a; }
        /* Custom Checkbox Style */
        .checkbox-card input:checked + div {
            background-color: #7c3aed; 
            border-color: #7c3aed;
            color: white;
        }
        .checkbox-card input:checked + div .icon-box {
            background-color: rgba(255,255,255,0.2);
            color: white;
        }
    </style>
</head>
<body class="text-gray-100 min-h-screen p-4 flex items-center justify-center">

    <div class="w-full max-w-2xl bg-gray-800 rounded-3xl shadow-2xl border border-gray-700 p-6 md:p-8">
        
        <div class="text-center mb-8">
            <h1 class="text-3xl font-black text-transparent bg-clip-text bg-gradient-to-r from-purple-400 to-blue-400 mb-2">
                Ù…ÙˆÙ„Ø¯ Ø§Ù„ØªØ±Ø§Ø®ÙŠØµ ğŸ”
            </h1>
            <p class="text-gray-400 text-sm">Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ… Ø§Ù„ÙƒØ§Ù…Ù„Ø© ÙÙŠ ØµÙ„Ø§Ø­ÙŠØ§Øª Ø§Ù„Ø¹Ù…ÙŠÙ„</p>
        </div>

        <form id="genForm" onsubmit="generateKey(event)" class="space-y-8">
            
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                <div>
                    <label class="block text-xs font-bold text-gray-400 mb-2">ÙƒÙˆØ¯ Ø¬Ù‡Ø§Ø² Ø§Ù„Ø¹Ù…ÙŠÙ„ (Machine ID)</label>
                    <input type="text" id="machineId" required class="w-full bg-gray-900 border border-gray-600 rounded-xl px-4 py-3 text-sm focus:border-purple-500 focus:ring-1 focus:ring-purple-500 outline-none transition font-mono text-center text-green-400" placeholder="Ù„ØµÙ‚ Ø§Ù„ÙƒÙˆØ¯ Ù‡Ù†Ø§...">
                </div>
                <div>
                    <label class="block text-xs font-bold text-gray-400 mb-2">Ù…Ø¯Ø© Ø§Ù„ØªØ±Ø®ÙŠØµ</label>
                    <select id="duration" class="w-full bg-gray-900 border border-gray-600 rounded-xl px-4 py-3 text-sm outline-none text-white appearance-none cursor-pointer">
                        <option value="30">ØªØ¬Ø±ÙŠØ¨ÙŠ (Ø´Ù‡Ø± ÙˆØ§Ø­Ø¯)</option>
                        <option value="90">3 Ø´Ù‡ÙˆØ± (Ø±Ø¨Ø¹ Ø³Ù†ÙˆÙŠ)</option>
                        <option value="180">6 Ø´Ù‡ÙˆØ± (Ù†ØµÙ Ø³Ù†ÙˆÙŠ)</option>
                        <option value="365" selected>Ø³Ù†Ø© ÙƒØ§Ù…Ù„Ø© (Standard)</option>
                        <option value="730">Ø³Ù†ØªÙŠÙ†</option>
                        <option value="36500">Ù†Ø³Ø®Ø© Ø¯Ø§Ø¦Ù…Ø© (Lifetime)</option>
                    </select>
                </div>
            </div>

            <div class="border-t border-gray-700 my-4"></div>

            <div>
                <div class="flex justify-between items-center mb-4">
                    <label class="text-sm font-bold text-gray-300">Ø­Ø¯Ø¯ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚Ø§Øª Ø§Ù„Ù…ØªØ§Ø­Ø© Ù„Ù„Ø¹Ù…ÙŠÙ„:</label>
                    <label class="flex items-center gap-2 cursor-pointer bg-gray-700 px-3 py-1 rounded-lg hover:bg-gray-600 transition">
                        <input type="checkbox" id="mod_all" onchange="toggleAll(this)" class="w-4 h-4 rounded text-purple-600 focus:ring-purple-500 bg-gray-800 border-gray-600">
                        <span class="text-xs font-bold text-white">ØªØ­Ø¯ÙŠØ¯ Ø§Ù„ÙƒÙ„</span>
                    </label>
                </div>

                <div class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 gap-3">
                    
                    <label class="checkbox-card cursor-pointer group">
                        <input type="checkbox" value="sales" class="hidden mod-item">
                        <div class="border border-gray-600 rounded-xl p-3 flex flex-col items-center gap-2 transition bg-gray-900/50 group-hover:bg-gray-700">
                            <span class="icon-box w-8 h-8 rounded-lg bg-blue-500/10 text-blue-400 flex items-center justify-center text-lg">ğŸ’°</span>
                            <span class="text-[10px] font-bold">Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª ÙˆØ§Ù„Ø¹Ù…Ù„Ø§Ø¡</span>
                        </div>
                    </label>

                    <label class="checkbox-card cursor-pointer group">
                        <input type="checkbox" value="pos" class="hidden mod-item">
                        <div class="border border-gray-600 rounded-xl p-3 flex flex-col items-center gap-2 transition bg-gray-900/50 group-hover:bg-gray-700">
                            <span class="icon-box w-8 h-8 rounded-lg bg-purple-500/10 text-purple-400 flex items-center justify-center text-lg">ğŸª</span>
                            <span class="text-[10px] font-bold">Ù†Ù‚Ø§Ø· Ø§Ù„Ø¨ÙŠØ¹ (POS)</span>
                        </div>
                    </label>

                    <label class="checkbox-card cursor-pointer group">
                        <input type="checkbox" value="inventory" class="hidden mod-item">
                        <div class="border border-gray-600 rounded-xl p-3 flex flex-col items-center gap-2 transition bg-gray-900/50 group-hover:bg-gray-700">
                            <span class="icon-box w-8 h-8 rounded-lg bg-orange-500/10 text-orange-400 flex items-center justify-center text-lg">ğŸ“¦</span>
                            <span class="text-[10px] font-bold">Ø§Ù„Ù…Ø®Ø§Ø²Ù† ÙˆØ§Ù„Ù…ÙˆØ±Ø¯ÙŠÙ†</span>
                        </div>
                    </label>

                    <label class="checkbox-card cursor-pointer group">
                        <input type="checkbox" value="accounting" class="hidden mod-item">
                        <div class="border border-gray-600 rounded-xl p-3 flex flex-col items-center gap-2 transition bg-gray-900/50 group-hover:bg-gray-700">
                            <span class="icon-box w-8 h-8 rounded-lg bg-green-500/10 text-green-400 flex items-center justify-center text-lg">ğŸ“Š</span>
                            <span class="text-[10px] font-bold">Ø§Ù„Ø­Ø³Ø§Ø¨Ø§Øª Ø§Ù„Ø¹Ø§Ù…Ø©</span>
                        </div>
                    </label>

                    <label class="checkbox-card cursor-pointer group">
                        <input type="checkbox" value="hr" class="hidden mod-item">
                        <div class="border border-gray-600 rounded-xl p-3 flex flex-col items-center gap-2 transition bg-gray-900/50 group-hover:bg-gray-700">
                            <span class="icon-box w-8 h-8 rounded-lg bg-pink-500/10 text-pink-400 flex items-center justify-center text-lg">ğŸ‘¥</span>
                            <span class="text-[10px] font-bold">Ø§Ù„Ù…ÙˆØ¸ÙÙŠÙ† (HR)</span>
                        </div>
                    </label>

                    <label class="checkbox-card cursor-pointer group">
                        <input type="checkbox" value="manufacturing" class="hidden mod-item">
                        <div class="border border-gray-600 rounded-xl p-3 flex flex-col items-center gap-2 transition bg-gray-900/50 group-hover:bg-gray-700">
                            <span class="icon-box w-8 h-8 rounded-lg bg-red-500/10 text-red-400 flex items-center justify-center text-lg">ğŸ­</span>
                            <span class="text-[10px] font-bold">Ø§Ù„ØªØµÙ†ÙŠØ¹</span>
                        </div>
                    </label>

                    <label class="checkbox-card cursor-pointer group">
                        <input type="checkbox" value="maintenance" class="hidden mod-item">
                        <div class="border border-gray-600 rounded-xl p-3 flex flex-col items-center gap-2 transition bg-gray-900/50 group-hover:bg-gray-700">
                            <span class="icon-box w-8 h-8 rounded-lg bg-yellow-500/10 text-yellow-400 flex items-center justify-center text-lg">ğŸ”§</span>
                            <span class="text-[10px] font-bold">Ø§Ù„ØµÙŠØ§Ù†Ø©</span>
                        </div>
                    </label>

                    <label class="checkbox-card cursor-pointer group">
                        <input type="checkbox" value="serials" class="hidden mod-item">
                        <div class="border border-gray-600 rounded-xl p-3 flex flex-col items-center gap-2 transition bg-gray-900/50 group-hover:bg-gray-700">
                            <span class="icon-box w-8 h-8 rounded-lg bg-gray-500/10 text-gray-400 flex items-center justify-center text-lg">ğŸ”¢</span>
                            <span class="text-[10px] font-bold">ØªØªØ¨Ø¹ Ø§Ù„Ø³ÙŠØ±ÙŠØ§Ù„Ø§Øª</span>
                        </div>
                    </label>

                    <label class="checkbox-card cursor-pointer group">
                        <input type="checkbox" value="backup" class="hidden mod-item">
                        <div class="border border-gray-600 rounded-xl p-3 flex flex-col items-center gap-2 transition bg-gray-900/50 group-hover:bg-gray-700">
                            <span class="icon-box w-8 h-8 rounded-lg bg-teal-500/10 text-teal-400 flex items-center justify-center text-lg">ğŸ’¾</span>
                            <span class="text-[10px] font-bold">Ø§Ù„Ù†Ø³Ø® Ø§Ù„Ø§Ø­ØªÙŠØ§Ø·ÙŠ</span>
                        </div>
                    </label>
                </div>
            </div>

            <button type="submit" class="w-full bg-gradient-to-r from-purple-600 to-blue-600 hover:from-purple-700 hover:to-blue-700 text-white font-bold py-4 rounded-xl shadow-lg shadow-purple-900/50 transition transform active:scale-95 text-lg">
                Ø¥Ù†Ø´Ø§Ø¡ ÙƒÙˆØ¯ Ø§Ù„ØªÙØ¹ÙŠÙ„ ğŸš€
            </button>
        </form>

        <div id="resultArea" class="hidden mt-8 pt-6 border-t border-gray-700 animate-fade-in bg-black/30 p-4 rounded-xl">
            <div class="flex justify-between items-center mb-2">
                <p class="text-xs text-green-400 font-bold">âœ… ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ù…ÙØªØ§Ø­ Ø¨Ù†Ø¬Ø§Ø­</p>
                <button onclick="copyToken()" class="bg-gray-700 hover:bg-gray-600 text-white text-[10px] px-3 py-1 rounded transition flex items-center gap-1">
                    <span>Ù†Ø³Ø®</span>
                    <svg class="w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 5H6a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2v-1M8 5a2 2 0 002 2h2a2 2 0 002-2M8 5a2 2 0 012-2h2a2 2 0 012 2m0 0h2a2 2 0 012 2v3m2 4H10m0 0l3-3m-3 3l3 3"></path></svg>
                </button>
            </div>
            <textarea id="finalToken" readonly rows="3" class="w-full bg-black/50 border border-green-500/30 rounded-lg p-3 text-[10px] text-gray-300 font-mono break-all resize-none focus:outline-none"></textarea>
        </div>

    </div>

    <script>
        // âš ï¸ Ù‡Ø°Ø§ Ø§Ù„Ù…ÙØªØ§Ø­ ÙŠØ¬Ø¨ Ø£Ù† ÙŠÙƒÙˆÙ† Ù…Ø·Ø§Ø¨Ù‚Ø§Ù‹ ØªÙ…Ø§Ù…Ø§Ù‹ Ù„Ù„Ù…ÙˆØ¬ÙˆØ¯ ÙÙŠ server.js Ø¹Ù†Ø¯ Ø§Ù„Ø¹Ù…ÙŠÙ„
        const SECRET_KEY = "ANSARY_SUPER_SECURE_ERPX_KEY_2026_!@#"; 

        function toggleAll(source) {
            const checkboxes = document.querySelectorAll('.mod-item');
            checkboxes.forEach(cb => {
                cb.checked = source.checked;
            });
        }

        function generateKey(e) {
            e.preventDefault();
            
            const machineId = document.getElementById('machineId').value.trim();
            if(!machineId) return alert('ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ ÙƒÙˆØ¯ Ø§Ù„Ø¬Ù‡Ø§Ø²!');

            // 1. ØªØ¬Ù…ÙŠØ¹ Ø§Ù„Ù…Ø¯ÙŠÙˆÙ„Ø§Øª Ø§Ù„Ù…Ø®ØªØ§Ø±Ø©
            let modules = [];
            const checkboxes = document.querySelectorAll('.mod-item:checked');
            checkboxes.forEach(cb => {
                modules.push(cb.value);
            });

            // Ù„Ùˆ Ø§Ø®ØªØ§Ø± ÙƒÙ„ Ø§Ù„Ø¨ÙˆÙƒØ³Ø§ØªØŒ Ù…Ù…ÙƒÙ† Ù†Ø­Ø· 'all' Ù„Ù„Ø§Ø®ØªØµØ§Ø±ØŒ Ø£Ùˆ Ù†Ø³ÙŠØ¨Ù‡Ù… Ù…ÙØµÙ„ÙŠÙ† (Ø§Ù„Ø£ÙØ¶Ù„ Ù…ÙØµÙ„ÙŠÙ† Ø¹Ø´Ø§Ù† Ù„Ùˆ Ø­Ø¨ÙŠØª ØªØ´ÙŠÙ„ Ø­Ø§Ø¬Ø© Ù…Ø³ØªÙ‚Ø¨Ù„Ø§Ù‹)
            if(checkboxes.length === document.querySelectorAll('.mod-item').length) {
                // modules = ['all']; // ÙŠÙ…ÙƒÙ†Ùƒ ØªÙØ¹ÙŠÙ„ Ù‡Ø°Ø§ Ø§Ù„Ø³Ø·Ø± Ù„Ùˆ Ø¹Ø§ÙŠØ² Ø§Ù„ÙƒÙˆØ¯ ÙŠØ¨Ù‚Ù‰ Ø£Ù‚ØµØ±ØŒ Ø¨Ø³ Ø§Ù„ØªÙØµÙŠÙ„ Ø£Ø£Ù…Ù†
            }

            if(modules.length === 0 && !document.getElementById('mod_all').checked) {
                return alert('âš ï¸ ÙŠØ¬Ø¨ Ø§Ø®ØªÙŠØ§Ø± ØªØ·Ø¨ÙŠÙ‚ ÙˆØ§Ø­Ø¯ Ø¹Ù„Ù‰ Ø§Ù„Ø£Ù‚Ù„!');
            }

            // 2. Ø§Ù„ØªØ§Ø±ÙŠØ®
            const days = parseInt(document.getElementById('duration').value);
            const now = Math.floor(Date.now() / 1000);
            const expiry = now + (days * 24 * 60 * 60);

            // 3. Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
            const payload = {
                machineId: machineId,
                modules: modules, // Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„ØªÙŠ Ø§Ø®ØªØ±ØªÙ‡Ø§
                type: 'pro',
                iat: now,
                exp: expiry
            };

            // 4. Ø§Ù„ØªØ´ÙÙŠØ±
            const token = signJWT(payload, SECRET_KEY);

            // 5. Ø§Ù„Ø¹Ø±Ø¶
            document.getElementById('resultArea').classList.remove('hidden');
            document.getElementById('finalToken').value = token;
            
            // Auto scroll to result
            document.getElementById('resultArea').scrollIntoView({ behavior: 'smooth' });
        }

        // Ø¯ÙˆØ§Ù„ Ø§Ù„ØªØ´ÙÙŠØ± Ø§Ù„Ù…Ø³Ø§Ø¹Ø¯Ø© (Standard JWT Signing)
        function signJWT(payload, secret) {
            const header = { alg: "HS256", typ: "JWT" };
            const stringifiedHeader = CryptoJS.enc.Utf8.parse(JSON.stringify(header));
            const encodedHeader = base64url(stringifiedHeader);
            const stringifiedPayload = CryptoJS.enc.Utf8.parse(JSON.stringify(payload));
            const encodedPayload = base64url(stringifiedPayload);
            const signature = CryptoJS.HmacSHA256(encodedHeader + "." + encodedPayload, secret);
            const encodedSignature = base64url(signature);
            return `${encodedHeader}.${encodedPayload}.${encodedSignature}`;
        }

        function base64url(source) {
            let encodedSource = CryptoJS.enc.Base64.stringify(source);
            encodedSource = encodedSource.replace(/=+$/, '');
            encodedSource = encodedSource.replace(/\+/g, '-');
            encodedSource = encodedSource.replace(/\//g, '_');
            return encodedSource;
        }

        function copyToken() {
            const copyText = document.getElementById("finalToken");
            copyText.select();
            copyText.setSelectionRange(0, 99999); 
            navigator.clipboard.writeText(copyText.value);
            alert("ØªÙ… Ù†Ø³Ø® Ø§Ù„ÙƒÙˆØ¯! Ø£Ø±Ø³Ù„Ù‡ Ù„Ù„Ø¹Ù…ÙŠÙ„.");
        }
    </script>
</body>
</html>
